<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=content-language content="en"><meta name=author content="Dacio Romero"><meta name=description content="Photo by Tim Gouw on Unsplash
Managing Memory An assignment that Jasmine and I had recently done for my instructor, Alan Davis, at Make School was given a large list of phone routes consisting of their standardized prefixes and costs.
The task was for increasing amounts of routes and phone numbers to find the longest matches and their prices.
Project Readme
Attempts List One being performing linear search on a list of phone numbers because I couldn&rsquo;t figure out a way to perform binary search."><meta name=keywords content="blog,developer"><meta name=twitter:card content="summary"><meta name=twitter:title content="Python Memory Management"><meta name=twitter:description content="Photo by Tim Gouw on Unsplash
Managing Memory An assignment that Jasmine and I had recently done for my instructor, Alan Davis, at Make School was given a large list of phone routes consisting of their standardized prefixes and costs.
The task was for increasing amounts of routes and phone numbers to find the longest matches and their prices.
Project Readme
Attempts List One being performing linear search on a list of phone numbers because I couldn&rsquo;t figure out a way to perform binary search."><meta property="og:title" content="Python Memory Management"><meta property="og:description" content="Photo by Tim Gouw on Unsplash
Managing Memory An assignment that Jasmine and I had recently done for my instructor, Alan Davis, at Make School was given a large list of phone routes consisting of their standardized prefixes and costs.
The task was for increasing amounts of routes and phone numbers to find the longest matches and their prices.
Project Readme
Attempts List One being performing linear search on a list of phone numbers because I couldn&rsquo;t figure out a way to perform binary search."><meta property="og:type" content="article"><meta property="og:url" content="https://dacio.dev/posts/2019/05/15/python-memory/"><meta property="article:published_time" content="2019-05-15T09:33:28-07:00"><meta property="article:modified_time" content="2019-05-15T09:33:28-07:00"><base href=https://dacio.dev/posts/2019/05/15/python-memory/><title>Python Memory Management · Dacio Romero</title><link rel=canonical href=https://dacio.dev/posts/2019/05/15/python-memory/><link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700&display=swap" rel=stylesheet><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.13.0/css/all.css integrity=sha384-Bfad6CLCknfcloXFOyFnlgtENryhrpZCe29RTifKEixXQZ38WheV+i/6YWSzkz3V crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin=anonymous><link rel=stylesheet href=/css/coder.min.0e5ce5b959a68dfe0232c6ddcec1e8ef154517c968464707f3181c437fe611c0.css integrity="sha256-DlzluVmmjf4CMsbdzsHo7xVFF8loRkcH8xgcQ3/mEcA=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.717236c74e0a5208ef73964a9f44c6b443b689a95b270d8b2a40d0c012460dac.css integrity="sha256-cXI2x04KUgjvc5ZKn0TGtEO2ialbJw2LKkDQwBJGDaw=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=https://dacio.dev/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://dacio.dev/images/favicon-16x16.png sizes=16x16><meta name=generator content="Hugo 0.74.3"></head><body class=colorscheme-auto><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>Dacio Romero</a>
<span id=dark-mode-toggle class=float-right><i class="fas fa-adjust fa-fw"></i></span><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fas fa-bars fa-fw"></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=https://dacio.dev/posts/>Blog</a></li><li class="navigation-item separator"><span>|</span></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title>Python Memory Management</h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fas fa-calendar"></i><time datetime=2019-05-15T09:33:28-07:00>May 15, 2019</time></span>
<span class=reading-time><i class="fas fa-clock"></i>4-minute read</span></div><div class=categories><i class="fas fa-folder"></i><a href=/categories/programming/>Programming</a></div><div class=tags><i class="fas fa-tag"></i><a href=/tags/python/>Python</a>
<span class=separator>•</span>
<a href=/tags/make-school/>Make School</a>
<span class=separator>•</span>
<a href=/tags/memory-management/>Memory Management</a></div></div></header><div><p><img src=https://source.unsplash.com/1K9T5YiZ2WU alt=Hero></p><p>Photo by Tim Gouw on Unsplash</p><h1 id=managing-memory>Managing Memory</h1><p>An assignment that <a href=https://medium.com/@jasmine.yhumbert>Jasmine</a> and I had recently done for my instructor, <a href=https://www.linkedin.com/in/alancdavis/>Alan Davis</a>, at <a href=https://www.makeschool.com/>Make School</a> was given a large list of phone routes consisting of their standardized prefixes and costs.</p><p>The task was for increasing amounts of routes and phone numbers to find the longest matches and their prices.</p><p><a href=https://github.com/Make-School-Courses/CS-1.3-Core-Data-Structures/blob/a622779357b055f925feb5f000996cb26c2ddf66/project/ReadMe.md>Project Readme</a></p><h2 id=attempts>Attempts</h2><h4 id=list>List</h4><p>One being performing linear search on a list of phone numbers because I couldn&rsquo;t figure out a way to perform binary search.</p><p><a href=https://github.com/lacunahag/call_routing_project/blob/e05e1577fc2f946b268ac4451fd7e11d4a8d6501/scenario1.py>File</a></p><h4 id=dictionary>Dictionary</h4><p>Our next step was to throw it all into a dictionary and keep removing characters off of my numbers until there was a match.</p><p><a href=https://github.com/lacunahag/call_routing_project/blob/e8d1fbe7a2d8560fd27e1b99ab9b445ad994e2a1/scenario2.py>File</a></p><h4 id=trie>Trie</h4><p>Jasmine said that <a href=https://en.wikipedia.org/wiki/Trie>tries</a> might be a good solution. You can read more about them <a href=https://medium.com/basecs/trying-to-understand-tries-3ec6bede0014>here</a>. Basically, they are a way of storing sequences of values, most commonly being strings.</p><p><img src=https://upload.wikimedia.org/wikipedia/commons/thumb/b/be/Trie_example.svg/819px-Trie_example.svg.png alt=Trie></p><p>Diagram - <a href=https://commons.wikimedia.org/wiki/File:Trie_example.svg>Source</a></p><p>To our dismay, it was using <strong><em>3 GB of RAM</em></strong> on a 10 million route dataset! When Jasmine tried to build her own it actually crashed on her laptop with 8 GB of RAM in total.</p><p><strong><em>It was time to track down where all our RAM is going.</em></strong></p><h1 id=tips-and-resources>Tips and Resources</h1><p>Through my attempts to optimize the memory, I have some pointers.</p><h2 id=pymplerhttpspythonhostedorgpympler><a href=https://pythonhosted.org/Pympler/>Pympler</a></h2><p>Pympler is a powerful tool to analyze memory usage.</p><h3 id=pymplerasizeofasizeofhttpspythonhostedorgpymplerlibraryasizeofhtmlhighlightasizeof20asizeofpymplerasizeofasizeof><a href="https://pythonhosted.org/Pympler/library/asizeof.html?highlight=asizeof%20asizeof#pympler.asizeof.asizeof">pympler.asizeof.asizeof</a></h3><p>This function recursively checks every object referenced by several objects allowing you to get the actual size in bytes.</p><p><img src=asizeof.png alt=Example></p><p>That&rsquo;s a whopping 1.2 GB!</p><h3 id=pymplertrackersummarytrackerhttpspythonhostedorgpymplerlibrarytrackerhtmlhighlightsummarytrackerpymplertrackersummarytracker><a href="https://pythonhosted.org/Pympler/library/tracker.html?highlight=summarytracker#pympler.tracker.SummaryTracker">pympler.tracker.SummaryTracker</a></h3><p>This class has a function called <code>print_diff</code> shows you how many of each type of new object there are and the amount of memory that they take up. This is useful</p><p><img src=summary-tracker.png alt=Example></p><p>This tracker is telling me that I should figure out how to <em>reduce the number of subtries</em> that I&rsquo;m creating and perhaps find another way to use lists.</p><p>The first time I used it I realized that I needed to <strong>stop using so many dictionaries</strong>. If I know the exact inputs my Trie will be receiving I could use one dictionary to map characters to parts of a list.</p><h3 id=much-much-more>Much much more</h3><p>Pympler has much more in store, I&rsquo;d highly recommend going through their documentation and seeing if there&rsquo;s anything of use.</p><h2 id=tracemallochttpsdocspythonorg3librarytracemallochtml><a href=https://docs.python.org/3/library/tracemalloc.html>tracemalloc</a></h2><p>Python 3.4 and up has a built-in memory tracer, but I admit I don&rsquo;t have as much experience with it.</p><h2 id=use-__slots__>Use <code>__slots__</code>!</h2><p>Slots in Python are a pretty quick way to reduce the memory usage of an object. By default Python uses dictionaries to store class attributes which you find in the variable <code>__dict__</code>.</p><p><img src=class-dict.png alt=Example></p><p>If you instead explicitly define which variables using <code>__slots__</code> your object will have you can save a <em>substantial</em> amount of memory which pays off with recursive data structures like tries.</p><p><img src=class-slots.png alt=Example></p><p>By using slots more than halved our memory usage while still storing the same data.</p><h2 id=default-to-none>Default to None</h2><p>In my Tries, I realized that there are a lot of moments when a Trie won&rsquo;t have any subtries, but I still made a list for them.</p><p>Although there&rsquo;s a bit of a tradeoff, I believe in situations where you have 4.6 million of the same object it&rsquo;s worth it to default variables to None and only creates them when necessary</p><p><img src=none.png alt=Example></p><p>The difference in sizes.</p><p>You can see that with more than <strong>4 million nodes</strong> the size of both empty dictionaries and empty lists can add up <em>incredibly</em> quickly.</p><blockquote><p>You should only create data structures when they&rsquo;re being used.</p></blockquote><h2 id=use-smaller-types>Use Smaller Types</h2><p>You might fall into the pattern of reusing one datatype multiple times because it worked like a dictionary.</p><blockquote><p>Nested dictionaries are common, but what if the keys are predictable?</p></blockquote><p>In our phone number problem, I realized that there were only going to be 11 characters &ldquo;+1234567890&rdquo;, so why should I use a data structure optimized for arbitrary keys?</p><p>I decided it would be worth it to create a &ldquo;mapper&rdquo; that converts a character into an index in a list.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#66d9ef>def</span> __init__(self, keys <span style=color:#f92672>=</span> None, items <span style=color:#f92672>=</span> None, _value <span style=color:#f92672>=</span> None, _mapper <span style=color:#f92672>=</span>  None):
  <span style=color:#66d9ef>if</span> _mapper:
    self<span style=color:#f92672>.</span>_mapper <span style=color:#f92672>=</span> _mapper
  <span style=color:#66d9ef>elif</span> keys:
    self<span style=color:#f92672>.</span>_mapper <span style=color:#f92672>=</span> {item: index <span style=color:#66d9ef>for</span> index, item <span style=color:#f92672>in</span> enumerate(keys)}
  <span style=color:#66d9ef>else</span>:
    <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>ValueError</span>(<span style=color:#e6db74>&#39;keys or _mapper must be provided&#39;</span>)

  self<span style=color:#f92672>.</span>_subtries <span style=color:#f92672>=</span> None
</code></pre></div><p><a href=https://github.com/lacunahag/call_routing_project/commit/4605171ef87696d555b880f41f9101b5041bc54c>Commit</a></p><p>This allows me to generate a mapper at the root and pass it down. I can then use it to get the index of where a Trie <em>should</em> be. This was <strong>by far</strong> one of the best optimizations that I made and reduced my memory usage from around <strong>3 GB to 1.5 GB</strong>.</p><h1 id=conclusion>Conclusion</h1><p>Optimizing your code for memory usage might not be one of the first things you might think to do. Once you&rsquo;re operating at scale, however, it becomes just as important as speed.</p><p>Take a look at <a href=https://github.com/lacunahag/call_routing_project>our repo</a> if you want to see our solution to the phone numbers problem</p><blockquote><p>I&rsquo;m looking for internships, so don&rsquo;t be afraid to reach out! <a href=https://www.linkedin.com/in/dacioromero/>My LinkedIn</a></p></blockquote></div><footer><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"dacio"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></footer></article></section></div><footer class=footer><section class=container>©
2019 -
2020
Dacio Romero</section></footer></main><script src=/js/dark-mode.min.0213e1773e6d1c5a644f847c67a6f8abac49a3776e2976f6008038af8c5b76a1.js></script></body></html>