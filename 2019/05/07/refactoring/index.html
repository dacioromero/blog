<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><link href=https://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=generator content="Hugo 0.74.3"><meta name=viewport content="width=device-width,initial-scale=1"><title>Getting to Refactoring &#183; Dacio's Tech Blog</title><meta name=description content><link type=text/css rel=stylesheet href=https://blog.dacio.dev/css/print.css media=print><link type=text/css rel=stylesheet href=https://blog.dacio.dev/css/poole.css><link type=text/css rel=stylesheet href=https://blog.dacio.dev/css/syntax.css><link type=text/css rel=stylesheet href=https://blog.dacio.dev/css/hyde.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700"><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/favicon.png></head><body><aside class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><a href=https://blog.dacio.dev/><h1>Dacio's Tech Blog</h1></a><p class=lead>The blog of an SF-based learner/programmer.</p></div><nav><ul class=sidebar-nav><li><a href=https://blog.dacio.dev/>Home</a></li><li><a href=https://github.com/dacioromero/>GitHub</a></li><li><a href=https://www.linkedin.com/in/dacioromero/>LinkedIn</a></li></ul></nav><p>&copy; 2020. All rights reserved.</p></div></aside><main class="content container"><div class=post><h1>Getting to Refactoring</h1><time datetime=2019-05-07T14:07:22-0700 class=post-date>Tue, May 7, 2019</time>
<center><img src=https://source.unsplash.com/vGgn0xLdy8s alt="Hero Image">
Photo by Annie Spratt on Unsplash</center><p>Every developer at some point will revisit their old project or snippet of code and be disgusted with the work they had. It is natural though: the name of the game as a developer is to <em>continually learn and improve</em>, so looking at old code is almost always when you didn&rsquo;t know as much as you do now.</p><p>At first, you might want to avoid messing with old code, but you&rsquo;re missing out an opportunity to learn, improve the maintainability of the code, make it more performant, or even make it a better portfolio item if it&rsquo;s something you can show publicly.</p><blockquote><p>Knowing that you should improve is the first step to <em>refactoring</em> your code.</p></blockquote><h1 id=what-is-it>What is it?</h1><p>Refactoring, in a nutshell, is making changes that <strong>don&rsquo;t</strong> change the functionality. A real life example would be that we don&rsquo;t care exactly how our local restaurant makes their food, so long as every time, we get the same food if we ask for the same item regardless of whatever changes the restaurant makes.</p><blockquote><p>If the restaurant hires new staff or gets our food to us faster to doesn&rsquo;t affect how we eat it.</p></blockquote><h1 id=examples>Examples</h1><h2 id=syntactic>Syntactic</h2><p>Following up on <a href=/2019/05/03/python-iterators-and-generators/>my previous post on iterators</a> let&rsquo;s see how I used my knowledge of iterators to refactor some code in the past.</p><h3 id=code>Code</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>find_index</span>(text, pattern):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span>  <span style=color:#66d9ef>if</span> pattern <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;&#39;</span>:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span>  <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(len(text) <span style=color:#f92672>-</span> len(pattern) <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span>    <span style=color:#66d9ef>if</span> text[i:i<span style=color:#f92672>+</span>len(pattern)] <span style=color:#f92672>==</span> pattern:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span>      <span style=color:#66d9ef>return</span> i
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span>  <span style=color:#66d9ef>return</span> None
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>find_all_indexes</span>(text, pattern):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span>  <span style=color:#66d9ef>if</span> pattern <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;&#39;</span>:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span>    <span style=color:#66d9ef>return</span> list(range(len(text)))
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span>  indices <span style=color:#f92672>=</span> []
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span>  <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(len(text) <span style=color:#f92672>-</span> len(pattern) <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span>    <span style=color:#66d9ef>if</span> text[i:i<span style=color:#f92672>+</span>len(pattern)] <span style=color:#f92672>==</span> pattern:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span>      indices<span style=color:#f92672>.</span>append(i)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span>  <span style=color:#66d9ef>return</span> indices
</code></pre></div><p><a href=https://gitlab.com/dacio/cs-1.3/blob/42d317279d0e6e392785eb0fa59404a1a9a8a813/Lessons/source/strings.py>Commit</a></p><p>Now there should be a couple of red flags going off in your head right about now.</p><p>Lines 5-7 and 18-20 are incredibly similar. This code isn&rsquo;t as <em>maintainable</em> because if anyone wants to change the search logic now there are <strong>two points</strong> to change.</p><p>At the time of writing the first example that I didn&rsquo;t fully understand how iterators and how they could improve this code. If you don&rsquo;t know what an iterator is it <em>lazily</em> produces values allowing you to perform actions on them one at a time. So let&rsquo;s make an iterator with a generator function that combines the logic of both of them.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>_find_indexes</span>(text, pattern):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span>  <span style=color:#66d9ef>if</span> pattern <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;&#39;</span>:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span>    <span style=color:#66d9ef>yield</span> <span style=color:#f92672>from</span> range(len(text))
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span>    <span style=color:#66d9ef>return</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span>  <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(len(text) <span style=color:#f92672>-</span> len(pattern) <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span>    <span style=color:#66d9ef>if</span> text[i:i<span style=color:#f92672>+</span>len(pattern)] <span style=color:#f92672>==</span> pattern:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span>      <span style=color:#66d9ef>yield</span> i
</code></pre></div><p>This generator function that returns an iterator which produces the starting indexes of matching patterns in our text. Now all we can change our old functions to be just:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>find_index</span>(text, pattern):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span>  <span style=color:#66d9ef>return</span> next(_find_indexes(text, pattern), None)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>find_all_indexes</span>(text, pattern):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span>  <span style=color:#66d9ef>return</span> list(_find_indexes(text, pattern))
</code></pre></div><p><a href=https://gitlab.com/dacio/cs-1.3/blob/ff0cd765a3dec0973e60f682b4bd49153658f669/Lessons/source/strings.py>Commit</a></p><h3 id=result>Result</h3><p>We&rsquo;ve reduced the complexity and improved the DRYness of our code. This helps <em>maintainability and readability</em>. If we want to improve the performance or any other aspect it&rsquo;d be much easier now. So let&rsquo;s do that.</p><h2 id=performance>Performance</h2><p>In both previous snippets, I used slicing to create substrings to compare to the pattern, but it&rsquo;s not a very performant operation. Checking if &ldquo;helps&rdquo; and &ldquo;hello&rdquo; were equal it&rsquo;s unnecessary to create an entirely new string for each potential spot when in this example we&rsquo;d know they aren&rsquo;t equal at the fourth character.</p><p>So let&rsquo;s see some code that uses another iterator to check each character individually.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>_find_indexes</span>(text, pattern):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span>  <span style=color:#66d9ef>if</span> pattern <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;&#39;</span>:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span>    <span style=color:#66d9ef>yield</span> <span style=color:#f92672>from</span> range(len(text))
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span>    <span style=color:#66d9ef>return</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span>  <span style=color:#75715e># Find matching indices</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span>  <span style=color:#66d9ef>for</span> index <span style=color:#f92672>in</span> range(len(text) <span style=color:#f92672>-</span> len(pattern) <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span>    char_gen <span style=color:#f92672>=</span> (text[i] <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(index, index <span style=color:#f92672>+</span> len(pattern)))
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span>    <span style=color:#66d9ef>for</span> char, pat_char <span style=color:#f92672>in</span> zip(char_gen, pattern):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span>      <span style=color:#66d9ef>if</span> char <span style=color:#f92672>!=</span> pat_char:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span>        <span style=color:#66d9ef>break</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span>    <span style=color:#66d9ef>else</span>:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span>      <span style=color:#66d9ef>yield</span> index
</code></pre></div><p><a href=https://gitlab.com/dacio/cs-1.3/commit/ff0cd765a3dec0973e60f682b4bd49153658f669>Commit</a></p><p>By creating <code>char_gen</code> and using it to check each character individually we&rsquo;ve reduced the number of operations done per substring we&rsquo;re checking. This increases the performance of our generator as subsequently both <code>find_all_indexes</code> and <code>find_index</code>!</p><h1 id=conclusion>Conclusion</h1><p>There are <em>many</em> other ways that you can refactor your code, but hopefully, this sets you down the right path to starting. What I&rsquo;ve shown are some pretty trivial examples, but the same pattern can be applied to most types of code.</p><blockquote><p>Look for places that have similar logic, are underperforming, or just simply are hard to understand and <strong>refactor</strong> it.</p></blockquote></div><h2>Comments</h2><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"dacio"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></main></body></html>